# sample-sam-app

## Lambda Function

- HelloWorldFunction - Auto generated by `sam init` command.
- SimpleResponseFunction - Receive a number and returns a string.
- SimpleDynamodbFunction - Receive JSON payload and put one item into 'UserMessage' table.
- WorkWithOtherFunction - Receive event occurred by other AWS service.

## Deploy LocalStack

`sam` command can be replaced by `samlocal` command.

```bash
sam build
samlocal deploy --guided
```

## Execution

- `awslocal` command can be replaced by `aws --profile xxxxx --endpoint-url http://localhost:4566`. 
- Check target function name by `lambda list-functions` before execute `lambda invoke`.

### HelloWorldFunction

```bash
awslocal lambda list-functions
awslocal lambda get-function --function-name "sample-sam-app-HelloWorldFunction-93a343b8"
awslocal lambda invoke --function-name "sample-sam-app-HelloWorldFunction-93a343b8" /tmp/response-helloworld.json
```

### SimpleResponseFunction

```bash
awslocal lambda list-functions
awslocal lambda get-function --function-name "sample-sam-app-SimpleResponseFunction-96533490"
awslocal lambda invoke \
--function-name "sample-sam-app-SimpleResponseFunction-96533490" \
--payload $(echo '{"number":1}' | base64) \
/tmp/response-simpleresponse.json
```

### SimpleDynamodbFunction

```bash
awslocal lambda list-functions
awslocal lambda get-function --function-name "sample-sam-app-SimpleDynamodbFunction-cdd357d1"
awslocal lambda invoke \
--function-name "sample-sam-app-SimpleDynamodbFunction-cdd357d1" \
--payload $(echo '{"sender":"Taro","receiver":"Jiro","message":"Hello, world!!"}' | base64) \
/tmp/response-dynamodb.json
```

### WorkWithOtherFunction

```bash
awslocal dynamodb put-item \
--table-name Member \
--item '{"seq":{"N":"1"},"name":{"S":"Taro"},"age":{"N":"30"},"sex":{"S":"MALE"}}'
awslocal dynamodb scan --table-name Member
awslocal logs describe-log-groups
awslocal logs describe-log-streams --log-group-name '/aws/lambda/sample-app-SimpleDynamodbFunction-1060c2e1'
awslocal logs get-log-events --log-group-name '/aws/lambda/sample-app-SimpleDynamodbFunction-1060c2e1' --log-stream-name '2024/08/20/[$LATEST]1e9df5806d0c0143c73481ae7f8e8938'
```